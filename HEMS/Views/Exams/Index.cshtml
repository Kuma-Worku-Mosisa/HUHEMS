@model IEnumerable<HEMS.Models.Exam>

@{
    ViewData["Title"] = "Exam Management";
}

<style>
    :root {
        --brand-primary: #4f46e5; /* Modern Indigo */
        --brand-dark: #1e293b;
        --brand-bg: #f8fafc;
    }

    body {
        background-color: var(--brand-bg);
    }

    .page-header {
        background: linear-gradient(135deg, var(--brand-dark) 0%, #334155 100%);
        color: white;
        border-radius: 12px;
    }

    .table-card {
        border: none;
        border-radius: 12px;
        overflow: hidden;
    }

    .btn-brand {
        background-color: var(--brand-primary);
        color: white;
        border: none;
        transition: 0.3s;
    }

        .btn-brand:hover {
            background-color: #4338ca;
            color: white;
            transform: translateY(-1px);
        }

    /* Responsive Table to Cards */
    @@media (max-width: 991.98px) {
        .desktop-table {
            display: none;
        }

        .mobile-card {
            display: block;
            background: white;
            border-radius: 12px;
            margin-bottom: 1rem;
            padding: 1.25rem;
            border: 1px solid #e2e8f0;
        }

            .mobile-card .title {
                font-size: 1.1rem;
                font-weight: 700;
                color: var(--brand-dark);
            }
    }

    @@media (min-width: 992px) {
        .mobile-card {
            display: none;
        }
    }
</style>

<div class="container-fluid py-4 px-lg-5">
    <div class="page-header p-4 mb-4 shadow-sm d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3">
        <div>
            <h2 class="fw-bold mb-1"><i class="bi bi-shield-check me-2"></i>Coordinator Dashboard</h2>
            <p class="opacity-75 mb-0">System Control & Exam Analytics</p>
        </div>
        <a asp-action="Create" class="btn btn-brand px-4 py-2 fw-semibold">
            <i class="bi bi-plus-lg me-2"></i>New Exam
        </a>
    </div>

    @if (!Model.Any())
    {
        <div class="text-center py-5 bg-white rounded-3 shadow-sm">
            <i class="bi bi-folder2-open display-1 text-muted opacity-25"></i>
            <h5 class="mt-3 text-secondary">No active exams found.</h5>
        </div>
    }
    else
    {
        <div class="card table-card shadow-sm desktop-table">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr class="text-secondary small text-uppercase fw-bold">
                        <th class="ps-4">Title</th>
                        <th>Academic Year</th>
                        <th>Duration</th>
                        <th>Status</th>
                        <th>Stats</th>
                        <th class="text-center">Control</th>
                    </tr>
                </thead>
                <tbody class="border-top-0">
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td class="ps-4">
                                <div class="fw-bold text-dark">@item.ExamTitle</div>
                                <span class="text-muted extra-small">ID: #@item.ExamId</span>
                            </td>
                            <td><span class="badge bg-light text-dark border"><i class="bi bi-calendar3 me-1"></i>@item.AcademicYear</span></td>
                            <td><i class="bi bi-clock-history me-1"></i>@item.DurationMinutes'</td>
                            <td>
                                @if (item.ExamStatus == "Published")
                                {
                                    <span class="badge rounded-pill bg-success-subtle text-success px-3">Live</span>
                                }
                                else
                                {

                                    <span class="badge rounded-pill bg-warning-subtle text-warning-emphasis px-3">Draft</span>
                                }
                            </td>
                            <td>
                                <span class="text-primary fw-semibold">@item.DefaultMark</span> <small class="text-muted">pts</small>
                                <div class="text-muted" style="font-size: 0.75rem;">@(item.Questions?.Count ?? 0) Questions</div>
                            </td>
                            <td class="text-center">
                                <div class="btn-group shadow-sm rounded">
                                    <a asp-controller="Questions" asp-action="Create" asp-route-examId="@item.ExamId" class="btn btn-sm btn-white border" title="Add Q"><i class="bi bi-plus-square text-primary"></i></a>
                                    <a asp-action="Details" asp-route-id="@item.ExamId" class="btn btn-sm btn-white border" title="Details"><i class="bi bi-info-circle"></i></a>
                                    <a asp-action="Edit" asp-route-id="@item.ExamId" class="btn btn-sm btn-white border" title="Edit"><i class="bi bi-pencil"></i></a>
                                    <a asp-action="Reports" asp-route-id="@item.ExamId" class="btn btn-sm btn-white border" title="Stats"><i class="bi bi-bar-chart"></i></a>
                                    <form asp-action="Delete" asp-route-id="@item.ExamId" method="post" id="del_@item.ExamId" class="d-inline">
                                        @Html.AntiForgeryToken()
                                        <button type="button" class="btn btn-sm btn-white border text-danger"
                                                data-bs-toggle="modal" data-bs-target="#reusableConfirmModal"
                                                data-title="Delete Exam" data-target="del_@item.ExamId" data-type="form"
                                                data-message="Confirm permanent deletion of @item.ExamTitle?">
                                            <i class="bi bi-trash3"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="mobile-container">
            @foreach (var item in Model)
            {
                <div class="mobile-card shadow-sm">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div class="title">@item.ExamTitle</div>
                        <span class="badge @(item.ExamStatus == "Published" ? "bg-success" : "bg-warning")">@item.ExamStatus</span>
                    </div>
                    <div class="row g-2 mb-3 text-muted small">
                        <div class="col-6"><i class="bi bi-calendar-event me-1"></i> @item.AcademicYear</div>
                        <div class="col-6 text-end"><i class="bi bi-clock me-1"></i> @item.DurationMinutes mins</div>
                    </div>
                    <div class="d-flex justify-content-between gap-2">
                        <a asp-action="Details" asp-route-id="@item.ExamId" class="btn btn-sm btn-outline-secondary w-100">View</a>
                        <a asp-action="Edit" asp-route-id="@item.ExamId" class="btn btn-sm btn-outline-primary w-100">Edit</a>
                    </div>
                </div>
            }
        </div>
    }
</div>

<partial name="_ConfirmationModal" />

@section Scripts {
    <script src="~/js/ui-interactions.js" asp-append-version="true"></script>
}