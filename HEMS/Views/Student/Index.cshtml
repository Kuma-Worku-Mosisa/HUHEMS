@model IEnumerable<HEMS.Models.Exam>

@{
    ViewData["Title"] = "Available Exams";
}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col">
            <h2 class="fw-bold"><i class="bi bi-pencil-square text-primary"></i> Available Exams</h2>
            <p class="text-muted">Select an exam to start your assessment.</p>
        </div>
    </div>

    <div class="row">
        @if (!Model.Any())
        {
            <div class="col-12 text-center py-5">
                <i class="bi bi-emoji-smile text-muted" style="font-size: 3rem;"></i>
                <p class="mt-3">No exams are currently published. Check back later!</p>
            </div>
        }
        else
        {
            @foreach (var exam in Model)
            {
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card shadow-sm border-0 h-100 transition-all hover-shadow" style="border-radius: 15px;">
                        <div class="card-body">
                            <h5 class="card-title fw-bold text-primary">@exam.ExamTitle</h5>
                            <p class="card-text text-muted small">
                                @(string.IsNullOrEmpty(exam.Description) ? "No description provided." : exam.Description)
                            </p>
                            <ul class="list-unstyled mb-4">
                                <li><i class="bi bi-clock me-2 text-secondary"></i><strong>Duration:</strong> @exam.DurationMinutes mins</li>
                                <li><i class="bi bi-calendar3 me-2 text-secondary"></i><strong>Year:</strong> @exam.AcademicYear</li>
                            </ul>
                        </div>
                        <div class="card-footer bg-transparent border-0 pb-4">
                            <button type="button"
                                    class="btn btn-primary w-100 rounded-pill fw-bold exam-action-btn"
                                    data-bs-toggle="modal"
                                    data-bs-target="#reusableConfirmModal"
                                    data-title="Start @exam.ExamTitle"
                                    data-message="Ready to begin? The timer will start immediately and cannot be paused."
                                    data-target="@Url.Action("TakeExam", "Student", new { examId = exam.ExamId })"
                                    data-type="link"
                                    data-exam-id="@exam.ExamId">
                                Start Exam
                            </button>
                        </div>
                    </div>
                </div>
            }
        }
    </div>
</div>

@* The Modal is now in its own partial to avoid duplication *@
<partial name="_ConfirmationModal" />

@section Scripts {
    <script src="~/js/ui-interactions.js" asp-append-version="true"></script>
    <script>
        $(document).ready(function() {
            // RESUME FEATURE UI UPDATE
            $('.exam-action-btn').each(function() {
                const examId = $(this).data('exam-id');
                const savedIndex = localStorage.getItem(`resume_exam_${examId}`);

                if (savedIndex !== null) {
                    $(this).text("Resume Exam");
                    $(this).removeClass("btn-primary").addClass("btn-success");

                    // Update target URL to include the saved index
                    const baseUrl = $(this).data('target');
                    $(this).attr('data-target', `${baseUrl}&index=${savedIndex}`);
                    $(this).attr('data-message', "Welcome back! You will continue from where you left off.");
                }
            });
        });
    </script>
}